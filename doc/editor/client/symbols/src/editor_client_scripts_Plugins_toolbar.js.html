<html><head><meta http-equiv="content-type" content="text/html; charset=UTF-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/** * Copyright (c) 2006 * Martin Czuchra, Nicolas Peters, Daniel Polak, Willi Tscheschner * * Permission is hereby granted, free of charge, to any person obtaining a * copy of this software and associated documentation files (the "Software"), * to deal in the Software without restriction, including without limitation * the rights to use, copy, modify, merge, publish, distribute, sublicense, * and/or sell copies of the Software, and to permit persons to whom the * Software is furnished to do so, subject to the following conditions: * * The above copyright notice and this permission notice shall be included in * all copies or substantial portions of the Software. * * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER * DEALINGS IN THE SOFTWARE. **/</span><span class="WHIT"></span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ORYX.Plugins</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">	</span><span class="NAME">ORYX.Plugins</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="PUNC">}</span><span class="WHIT"></span><span class="NAME">ORYX.Plugins.Toolbar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Clazz.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">	</span><span class="NAME">facade</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">	</span><span class="NAME">plugs</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">	</span><span class="NAME">construct</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">facade</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ownPluginData</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">this.facade</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">facade</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">this.groupIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Hash</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">ownPluginData.properties.each</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value.group</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">value.index</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">				</span><span class="NAME">this.groupIndex</span><span class="PUNC">[</span><span class="NAME">value.group</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value.index</span><span class="WHIT"></span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">Ext.QuickTips.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">this.buttons</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.facade.registerOnEvent</span><span class="PUNC">(</span><span class="NAME">ORYX.CONFIG.EVENT_BUTTON_UPDATE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.onButtonUpdate.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">/**     * Can be used to manipulate the state of a button.     * @example     * this.facade.raiseEvent({     *   type: ORYX.CONFIG.EVENT_BUTTON_UPDATE,     *   id: this.buttonId, // have to be generated before and set in the offer method     *   pressed: true     * });     * @param {Object} event     */</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">onButtonUpdate</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.buttons.find</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">button.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">event.id</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">event.pressed</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">button.buttonInstance.toggle</span><span class="PUNC">(</span><span class="NAME">event.pressed</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">	</span><span class="NAME">registryChanged</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pluginsData</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">// Sort plugins by group and index</span><span class="WHIT"></span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newPlugs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">pluginsData.sortBy</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.groupIndex</span><span class="PUNC">[</span><span class="NAME">value.group</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.groupIndex</span><span class="PUNC">[</span><span class="NAME">value.group</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">value.group</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">value.index</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">plugs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$A</span><span class="PUNC">(</span><span class="NAME">newPlugs</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">findAll</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">										</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.plugs.include</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">									</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">plugs.length</span><span class="PUNC">&lt;</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">			</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">this.buttons</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">ORYX.Log.trace</span><span class="PUNC">(</span><span class="STRN">"Creating a toolbar."</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.toolbar</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">			</span><span class="NAME">this.toolbar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.ux.SlicedToolbar</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">			</span><span class="NAME">height</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">24</span><span class="WHIT"></span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">region</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.facade.addToRegion</span><span class="PUNC">(</span><span class="STRN">"north"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.toolbar</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Toolbar"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">		</span><span class="WHIT"></span><span class="WHIT">		</span><span class="WHIT"></span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentGroupsName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.plugs.last</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.plugs.last</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">group</span><span class="PUNC">:</span><span class="NAME">plugs</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">group</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">// Map used to store all drop down buttons of current group</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentGroupsDropDownButton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">plugs.each</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">value.name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">			</span><span class="NAME">this.plugs.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">// Add seperator if new group begins</span><span class="WHIT"></span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">currentGroupsName</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">value.group</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">			    </span><span class="NAME">this.toolbar.add</span><span class="PUNC">(</span><span class="STRN">'-'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">				</span><span class="NAME">currentGroupsName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value.group</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">currentGroupsDropDownButton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">			</span><span class="COMM">//add eventtracking</span><span class="WHIT"></span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tmp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value.functionality</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">			</span><span class="NAME">value.functionality</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">				 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"undefined"</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">pageTracker</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">pageTracker._trackEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">				 </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">					</span><span class="NAME">pageTracker._trackEvent</span><span class="PUNC">(</span><span class="STRN">"ToolbarButton"</span><span class="PUNC">,</span><span class="NAME">value.name</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">tmp.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">// If an drop down group icon is provided, a split button should be used</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value.dropDownGroupIcon</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">splitButton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentGroupsDropDownButton</span><span class="PUNC">[</span><span class="NAME">value.dropDownGroupIcon</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">// Create a new split button if this is the first plugin using it </span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">splitButton</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">splitButton</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentGroupsDropDownButton</span><span class="PUNC">[</span><span class="NAME">value.dropDownGroupIcon</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.Toolbar.SplitButton</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">cls</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"x-btn-icon"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//show icon only</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">icon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value.dropDownGroupIcon</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">menu</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.menu.Menu</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="NAME">items</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="COMM">// items are added later on</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">listeners</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                          </span><span class="NAME">click</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">// The "normal" button should behave like the arrow button</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">button.menu.isVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">button.ignoreNextClick</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="NAME">button.showMenu</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="NAME">button.hideMenu</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                          </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">this.toolbar.add</span><span class="PUNC">(</span><span class="NAME">splitButton</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">// General config button which will be used either to create a normal button</span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">// or a check button (if toggling is enabled)</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">buttonCfg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">icon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value.icon</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">text</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value.name</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">itemId</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value.id</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value.toggle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value.functionality</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">checkHandler</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value.toggle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">value.functionality</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">listeners</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="NAME">render</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="COMM">// After rendering, a tool tip should be added to component</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value.description</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.ToolTip</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                                    </span><span class="NAME">target</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">item.getEl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">                                    </span><span class="NAME">title</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value.description</span><span class="WHIT"></span><span class="WHIT">                                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="WHIT"></span><span class="WHIT">                </span><span class="COMM">// Create buttons depending on toggle</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value.toggle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.menu.CheckItem</span><span class="PUNC">(</span><span class="NAME">buttonCfg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.menu.Item</span><span class="PUNC">(</span><span class="NAME">buttonCfg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">splitButton.menu.add</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// create normal, simple button</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.Toolbar.Button</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">icon</span><span class="PUNC">:</span><span class="WHIT">           </span><span class="NAME">value.icon</span><span class="PUNC">,</span><span class="WHIT">         </span><span class="COMM">// icons can also be specified inline</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">cls</span><span class="PUNC">:</span><span class="WHIT">            </span><span class="STRN">'x-btn-icon'</span><span class="PUNC">,</span><span class="WHIT">       </span><span class="COMM">// Class who shows only the icon</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">itemId</span><span class="PUNC">:</span><span class="WHIT">         </span><span class="NAME">value.id</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">					</span><span class="NAME">tooltip</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NAME">value.description</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="COMM">// Set the tooltip</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">tooltipType</span><span class="PUNC">:</span><span class="WHIT">    </span><span class="STRN">'title'</span><span class="PUNC">,</span><span class="WHIT">            </span><span class="COMM">// Tooltip will be shown as in the html-title attribute</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="WHIT">        </span><span class="NAME">value.toggle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">value.functionality</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="COMM">// Handler for mouse click</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">enableToggle</span><span class="PUNC">:</span><span class="WHIT">   </span><span class="NAME">value.toggle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// Option for enabling toggling</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">toggleHandler</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NAME">value.toggle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">value.functionality</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="COMM">// Handler for toggle (Parameters: button, active)</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT"></span><span class="WHIT">                </span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">this.toolbar.add</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">button.getEl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">onclick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">this.blur</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">			     </span><span class="WHIT"></span><span class="WHIT">			</span><span class="NAME">value</span><span class="PUNC">[</span><span class="STRN">'buttonInstance'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">button</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">			</span><span class="NAME">this.buttons.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">			</span><span class="WHIT"></span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">this.enableButtons</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">//TODO this should be done when resizing and adding elements!!!!</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.toolbar.calcSlices</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">window.addEventListener</span><span class="PUNC">(</span><span class="STRN">"resize"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.toolbar.calcSlices</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">window.addEventListener</span><span class="PUNC">(</span><span class="STRN">"onresize"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.toolbar.calcSlices</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">	</span><span class="WHIT"></span><span class="WHIT">	</span><span class="NAME">onSelectionChanged</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">this.enableButtons</span><span class="PUNC">(</span><span class="NAME">event.elements</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">	</span><span class="NAME">enableButtons</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elements</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">		</span><span class="COMM">// Show the Buttons</span><span class="WHIT"></span><span class="WHIT">		</span><span class="NAME">this.buttons.each</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">			</span><span class="NAME">value.buttonInstance.enable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">						</span><span class="WHIT"></span><span class="WHIT">			</span><span class="COMM">// If there is less elements than minShapes</span><span class="WHIT"></span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value.minShape</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">value.minShape</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">elements.length</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">				</span><span class="NAME">value.buttonInstance.disable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">			</span><span class="COMM">// If there is more elements than minShapes</span><span class="WHIT"></span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value.maxShape</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">value.maxShape</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">elements.length</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">				</span><span class="NAME">value.buttonInstance.disable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT"></span><span class="WHIT">			</span><span class="COMM">// If the plugin is not enabled	</span><span class="WHIT"></span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">value.isEnabled</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">value.isEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"></span><span class="WHIT">				</span><span class="NAME">value.buttonInstance.disable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">			</span><span class="WHIT"></span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT"></span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"></span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="NAME">Ext.ns</span><span class="PUNC">(</span><span class="STRN">"Ext.ux"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="NAME">Ext.ux.SlicedToolbar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Ext.extend</span><span class="PUNC">(</span><span class="NAME">Ext.Toolbar</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">currentSlice</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">iconStandardWidth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">22</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//22 px </span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">seperatorStandardWidth</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//2px, minwidth for Ext.Toolbar.Fill</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">toolbarStandardPadding</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">initComponent</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">Ext.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">Ext.ux.SlicedToolbar.superclass.initComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">onRender</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">Ext.ux.SlicedToolbar.superclass.onRender.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">onResize</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">Ext.ux.SlicedToolbar.superclass.onResize.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">calcSlices</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.sliceMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sliceWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">toolbarWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getEl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.items.getRange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="COMM">//Remove all next and prev buttons</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">item.helperItem</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">item.destroy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.getEl</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">sliceWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">itemWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.iconStandardWidth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">toolbarWidth</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.items.indexOf</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">this.insertSlicingButton</span><span class="PUNC">(</span><span class="STRN">"next"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="WHIT"></span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">slice</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">                    </span><span class="NAME">this.insertSlicingButton</span><span class="PUNC">(</span><span class="STRN">"prev"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">                </span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">this.insertSlicingSeperator</span><span class="PUNC">(</span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">itemIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">slice</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">                </span><span class="NAME">sliceWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">            </span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.sliceMap</span><span class="PUNC">[</span><span class="NAME">item.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">sliceWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">itemWidth</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">// Add prev button at the end</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">slice</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.insertSlicingSeperator</span><span class="PUNC">(</span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.items.getCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.insertSlicingButton</span><span class="PUNC">(</span><span class="STRN">"prev"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.items.getCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">spacer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.Toolbar.Spacer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">this.insertSlicedHelperButton</span><span class="PUNC">(</span><span class="NAME">spacer</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.items.getCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">Ext.get</span><span class="PUNC">(</span><span class="NAME">spacer.id</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setWidth</span><span class="PUNC">(</span><span class="NAME">this.iconStandardWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT"></span><span class="WHIT">        </span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.maxSlice</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">// Update view</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.setCurrentSlice</span><span class="PUNC">(</span><span class="NAME">this.currentSlice</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">insertSlicedButton</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.insertButton</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">button</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.sliceMap</span><span class="PUNC">[</span><span class="NAME">button.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">insertSlicedHelperButton</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">button.helperItem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.insertSlicedButton</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">insertSlicingSeperator</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="COMM">// Align right</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.insertSlicedHelperButton</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.Toolbar.Fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="COMM">// type => next or prev</span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">insertSlicingButton</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setCurrentSlice</span><span class="PUNC">(</span><span class="NAME">this.currentSlice</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prevHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">this.setCurrentSlice</span><span class="PUNC">(</span><span class="NAME">this.currentSlice</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Ext.Toolbar.Button</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">cls</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"x-btn-icon"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">icon</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ORYX.CONFIG.ROOT_PATH</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"images/toolbar_"</span><span class="PUNC">+</span><span class="NAME">type</span><span class="PUNC">+</span><span class="STRN">".png"</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"next"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">nextHandler</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">prevHandler</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.insertSlicedHelperButton</span><span class="PUNC">(</span><span class="NAME">button</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"></span><span class="WHIT">    </span><span class="WHIT"></span><span class="WHIT">    </span><span class="NAME">setCurrentSlice</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">slice</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">slice</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.maxSlice</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.currentSlice</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">slice</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="NAME">this.items.getRange</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">each</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT"></span><span class="WHIT">            </span><span class="NAME">item.setVisible</span><span class="PUNC">(</span><span class="NAME">slice</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">this.sliceMap</span><span class="PUNC">[</span><span class="NAME">item.id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">.</span><span class="NAME">bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"></span><span class="WHIT">    </span><span class="PUNC">}</span><span class="WHIT"></span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span></pre></body></html>